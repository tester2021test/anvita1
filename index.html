<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Anvita's Match World</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-sky: #87CEEB;
    --btn-skip: #FF9F1C;
    --btn-sound: #2EC4B6;
    --btn-home: #FF5A5F;
  }

  body {
    margin: 0; overflow: hidden;
    background: linear-gradient(180deg, var(--bg-sky) 0%, #E0F7FA 100%);
    font-family: 'Fredoka One', cursive;
    touch-action: none; user-select: none;
    height: 100vh; display: flex; flex-direction: column;
  }

  /* --- ANIMATIONS --- */
  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-10px) rotate(-5deg); }
    50% { transform: translateX(10px) rotate(5deg); }
    75% { transform: translateX(-10px) rotate(-5deg); }
    100% { transform: translateX(0); }
  }

  .shake-it { animation: shake 0.4s ease-in-out; border-color: #ff4757 !important; }

  /* --- LAYOUT --- */
  #welcomeScreen {
    position: absolute; top:0; left:0; width:100%; height:100%;
    background: rgba(255,255,255,0.98); z-index: 9999;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center; gap: 20px;
  }
  .btn-start {
    background: var(--btn-skip); color: white; border: none;
    padding: 15px 60px; font-size: 2rem; border-radius: 50px;
    box-shadow: 0 8px 0 #E08E00; cursor: pointer;
  }
  .btn-start:active { transform: translateY(4px); box-shadow: 0 4px 0 #E08E00; }
  
  header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
  .score-board { font-size: 1.3rem; color: #444; background: rgba(255,255,255,0.8); padding: 8px 20px; border-radius: 30px; }

  .game-container {
    flex: 1; z-index: 10; display: flex; flex-direction: column;
    justify-content: space-evenly; align-items: center;
    width: 100%; max-width: 600px; margin: 0 auto;
    transition: opacity 0.3s;
  }

  /* TARGETS */
  .targets-area { display: flex; gap: 20px; }
  .target-box {
    width: 38vw; height: 38vw; max-width: 150px; max-height: 150px;
    background: rgba(255,255,255,0.4); border: 4px dashed #888; border-radius: 25px;
    display: flex; justify-content: center; align-items: center;
    position: relative; transition: 0.3s;
  }
  .target-box img { width: 75%; height: 75%; object-fit: contain; opacity: 0.25; filter: grayscale(100%); }
  .target-box.success { background: #fff; border-style: solid; border-color: #4CAF50; transform: scale(1.1); box-shadow: 0 0 30px #4CAF50; }
  .target-box.success img { opacity: 1; filter: none; }

  /* DRAGGABLES */
  .drag-area { display: flex; gap: 20px; height: 160px; align-items: center; }
  .drag-item {
    width: 32vw; height: 32vw; max-width: 120px; max-height: 120px;
    background: #fff; border-radius: 50%; border: 5px solid #fff;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    display: flex; justify-content: center; align-items: center;
    cursor: grab; touch-action: none; z-index: 20; position: relative;
    font-size: 3rem; /* For Emoji Fallback */
  }
  .drag-item img { width: 70%; height: 70%; object-fit: contain; pointer-events: none; }
  .drag-item:active { transform: scale(1.1); }

  /* CONTROLS */
  .controls { z-index: 10; display: flex; gap: 20px; padding-bottom: 25px; justify-content: center; }
  .icon-btn {
    width: 60px; height: 60px; border-radius: 50%; border: none;
    color: white; font-size: 1.8rem; cursor: pointer;
    box-shadow: 0 6px 0 rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center;
  }
  .icon-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }
  .btn-home { background: var(--btn-home); }
  .btn-speak { background: var(--btn-sound); }
  .btn-skip { background: var(--btn-skip); }

  canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1000; }
</style>
</head>
<body>

  <div style="position:absolute; top:-40px; right:-40px; width:140px; height:140px; background:#FFD93D; border-radius:50%; box-shadow:0 0 50px #FF9F1C; z-index:0;"></div>

  <div id="welcomeScreen">
    <h1>üéà Match Game</h1>
    <input type="text" id="kidName" value="Anvita" style="padding:10px; font-size:1.5rem; border-radius:15px; border:3px solid #ccc; text-align:center;">
    <button class="btn-start" onclick="startGame()">PLAY</button>
  </div>

  <header>
    <div id="displayName" style="font-size:1.2rem; color:#333;">Player</div>
    <div class="score-board">‚≠ê <span id="scoreVal">0</span></div>
  </header>

  <div class="game-container" id="gameBoard">
    <div class="targets-area" id="targets"></div>
    <div class="drag-area" id="draggables"></div>
  </div>

  <div class="controls">
    <button class="icon-btn btn-home" onclick="goHome()">üè†</button>
    <button class="icon-btn btn-speak" onclick="repeatNames()">üîä</button>
    <button class="icon-btn btn-skip" onclick="skipLevel()">‚ûú</button>
  </div>

  <canvas id="confetti"></canvas>

<script>
// --- DATABASE WITH EMOJI FALLBACKS ---
const DATABASE = [
  { id: 'lion', name: 'Lion', emoji: 'ü¶Å', img: 'https://cdn-icons-png.flaticon.com/512/616/616412.png' },
  { id: 'monkey', name: 'Monkey', emoji: 'üêµ', img: 'https://cdn-icons-png.flaticon.com/512/616/616551.png' },
  { id: 'cat', name: 'Cat', emoji: 'üê±', img: 'https://cdn-icons-png.flaticon.com/512/616/616430.png' },
  { id: 'dog', name: 'Dog', emoji: 'üê∂', img: 'https://cdn-icons-png.flaticon.com/512/616/616408.png' },
  { id: 'apple', name: 'Apple', emoji: 'üçé', img: 'https://cdn-icons-png.flaticon.com/512/415/415733.png' },
  { id: 'banana', name: 'Banana', emoji: 'üçå', img: 'https://cdn-icons-png.flaticon.com/512/415/415682.png' },
  { id: 'grape', name: 'Grapes', emoji: 'üçá', img: 'https://cdn-icons-png.flaticon.com/512/415/415712.png' },
  { id: 'car', name: 'Car', emoji: 'üöó', img: 'https://cdn-icons-png.flaticon.com/512/2554/2554936.png' },
  { id: 'bus', name: 'Bus', emoji: 'üöå', img: 'https://cdn-icons-png.flaticon.com/512/2554/2554905.png' },
  { id: 'plane', name: 'Plane', emoji: '‚úàÔ∏è', img: 'https://cdn-icons-png.flaticon.com/512/2554/2554909.png' },
  { id: 'sun', name: 'Sun', emoji: '‚òÄÔ∏è', img: 'https://cdn-icons-png.flaticon.com/512/869/869869.png' },
  { id: 'moon', name: 'Moon', emoji: 'üåô', img: 'https://cdn-icons-png.flaticon.com/512/1162/1162483.png' }
];

let currentPlayer = "Anvita";
let currentScore = 0;
let currentItems = [];
let itemsToMatch = 0;
let autoNextTimer = null;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

// --- SOUND ENGINE (Synthesized - No files needed) ---
function playSound(type) {
  if (audioCtx.state === 'suspended') audioCtx.resume();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);

  const now = audioCtx.currentTime;
  if(type === 'pop') {
    osc.type = 'sine';
    osc.frequency.setValueAtTime(400, now);
    osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.linearRampToValueAtTime(0, now + 0.1);
    osc.start(now); osc.stop(now + 0.1);
  } else if(type === 'success') {
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(500, now);
    osc.frequency.setValueAtTime(800, now + 0.1);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.linearRampToValueAtTime(0, now + 0.4);
    osc.start(now); osc.stop(now + 0.4);
  } else if(type === 'error') {
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(200, now);
    osc.frequency.linearRampToValueAtTime(100, now + 0.2);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.linearRampToValueAtTime(0, now + 0.2);
    osc.start(now); osc.stop(now + 0.2);
  }
}

function speak(text) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US'; u.rate = 1.0;
  window.speechSynthesis.speak(u);
}

// --- GAME LOGIC ---
function startGame() {
  const nameIn = document.getElementById('kidName').value;
  if(nameIn.trim()) currentPlayer = nameIn.trim();
  document.getElementById('welcomeScreen').style.display = 'none';
  document.getElementById('displayName').innerText = currentPlayer;
  nextLevel();
}

function goHome() {
  document.getElementById('welcomeScreen').style.display = 'flex';
  clearTimeout(autoNextTimer);
}

function skipLevel() {
  playSound('pop');
  nextLevel();
}

function nextLevel() {
  clearTimeout(autoNextTimer);
  const board = document.getElementById('gameBoard');
  board.style.opacity = '0';

  setTimeout(() => {
    // Logic: Pick 2 random
    itemsToMatch = 2;
    currentItems = DATABASE.sort(() => 0.5 - Math.random()).slice(0, 2);
    renderBoard();
    board.style.opacity = '1';
    speak(`Find the ${currentItems[0].name} and the ${currentItems[1].name}`);
  }, 300);
}

function renderBoard() {
  const tArea = document.getElementById('targets');
  const dArea = document.getElementById('draggables');
  tArea.innerHTML = ''; dArea.innerHTML = '';

  // Targets
  currentItems.forEach(item => {
    const t = document.createElement('div');
    t.className = 'target-box';
    t.id = `target-${item.id}`;
    // Emoji Fallback logic inside onerror
    t.innerHTML = `<img src="${item.img}" onerror="this.style.display='none'; this.parentElement.innerText='${item.emoji}'; this.parentElement.style.fontSize='4rem';">`;
    tArea.appendChild(t);
  });

  // Draggables
  [...currentItems].sort(()=>0.5-Math.random()).forEach(item => {
    const d = document.createElement('div');
    d.className = 'drag-item';
    d.dataset.id = item.id;
    d.dataset.name = item.name;
    // Emoji Fallback logic
    d.innerHTML = `<img src="${item.img}" onerror="this.style.display='none'; this.parentElement.innerText='${item.emoji}';">`;
    makeDraggable(d);
    dArea.appendChild(d);
  });
}

function repeatNames() {
  speak(`${currentItems[0].name} ... and ... ${currentItems[1].name}`);
}

// --- DRAG LOGIC ---
function makeDraggable(el) {
  let startX, startY;
  
  function onDown(e) {
    if(el.classList.contains('locked')) return;
    e.preventDefault();
    playSound('pop');
    speak(el.dataset.name);
    el.setPointerCapture(e.pointerId);
    
    const rect = el.getBoundingClientRect();
    startX = e.clientX; startY = e.clientY;
    
    el.style.position = 'fixed';
    el.style.left = rect.left + 'px'; el.style.top = rect.top + 'px';
    el.style.zIndex = 1000;
  }

  function onMove(e) {
    if(el.style.position !== 'fixed') return;
    e.preventDefault();
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    el.style.transform = `translate(${dx}px, ${dy - 60}px) scale(1.15)`;
  }

  function onUp(e) {
    if(el.style.position !== 'fixed') return;
    el.releasePointerCapture(e.pointerId);
    
    // Check targets
    let droppedCorrect = false;
    let droppedWrong = false;
    
    // Find what we are hovering over
    // We temporarily hide the drag item to see what is underneath
    el.hidden = true; 
    const elemBelow = document.elementFromPoint(e.clientX, e.clientY);
    el.hidden = false;

    if(elemBelow) {
      const target = elemBelow.closest('.target-box');
      if(target) {
        if(target.id === `target-${el.dataset.id}`) {
          droppedCorrect = true;
          handleMatch(el, target);
        } else {
          droppedWrong = true;
        }
      }
    }

    if(!droppedCorrect) {
      // Return Animation
      el.style.transition = '0.3s';
      el.style.transform = 'translate(0,0)';
      
      if(droppedWrong) {
        // ERROR SHAKE
        playSound('error');
        el.classList.add('shake-it');
        speak("Uh oh!");
        setTimeout(()=> el.classList.remove('shake-it'), 500);
      }
      
      setTimeout(() => {
        el.style.position = ''; el.style.left = ''; el.style.top = ''; el.style.zIndex = ''; el.style.transition = '';
      }, 300);
    }
  }

  el.addEventListener('pointerdown', onDown);
  el.addEventListener('pointermove', onMove);
  el.addEventListener('pointerup', onUp);
}

function handleMatch(dragEl, targetEl) {
  dragEl.remove();
  targetEl.classList.add('success');
  playSound('success');
  
  const r = targetEl.getBoundingClientRect();
  spawnConfetti(r.left+r.width/2, r.top+r.height/2);
  
  itemsToMatch--;
  currentScore++;
  document.getElementById('scoreVal').innerText = currentScore;

  if(itemsToMatch === 0) {
    setTimeout(() => {
      speak(`Good Job ${currentPlayer}!`);
      spawnConfetti(window.innerWidth/2, window.innerHeight/2, 50);
      autoNextTimer = setTimeout(nextLevel, 2500);
    }, 500);
  }
}

// --- CONFETTI ---
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
let particles = [];
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.onresize = resize; resize();

function spawnConfetti(x, y, count=25) {
  for(let i=0; i<count; i++) {
    particles.push({
      x: x, y: y,
      vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15 - 5,
      life: Math.random()*50 + 30,
      color: `hsl(${Math.random()*360}, 100%, 60%)`,
      size: Math.random()*8 + 4
    });
  }
}
function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1; i>=0; i--) {
    let p = particles[i];
    p.x += p.vx; p.y += p.vy; p.vy += 0.4; p.life--;
    ctx.fillStyle = p.color;
    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
    if(p.life<=0) particles.splice(i,1);
  }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
