<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Anvita's Perfect Match</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-sky: #87CEEB;
    --btn-color: #FF9F1C;
  }

  /* PREVENT SCROLLING ON MOBILE */
  html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    overflow: hidden; /* Critical for drag games */
    background: linear-gradient(180deg, var(--bg-sky) 0%, #E0F7FA 100%);
    font-family: 'Fredoka One', cursive;
    touch-action: none; /* Disables browser zooming/scrolling */
    user-select: none;
    -webkit-user-select: none;
  }

  body {
    display: flex; flex-direction: column;
    align-items: center; justify-content: space-between;
  }

  /* LAYOUT */
  .header {
    padding-top: 20px;
    text-align: center;
    height: 15vh;
  }
  .header h1 { margin: 0; color: #333; font-size: 1.5rem; }
  .score { font-size: 1.2rem; color: #555; background: rgba(255,255,255,0.6); padding: 5px 15px; border-radius: 20px; display: inline-block; margin-top: 5px;}

  /* GAME AREA */
  .game-board {
    flex: 1;
    width: 100%;
    max-width: 500px;
    display: flex;
    flex-direction: column;
    justify-content: space-evenly; /* Even spacing */
    align-items: center;
    position: relative;
  }

  /* DROP ZONES (TARGETS) */
  .targets-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    width: 100%;
  }

  .target-box {
    width: 110px; height: 110px;
    background: rgba(255,255,255,0.4);
    border: 4px dashed #888;
    border-radius: 20px;
    display: flex; justify-content: center; align-items: center;
    position: relative;
    transition: transform 0.2s;
  }
  
  /* Ghost image inside target */
  .target-box img {
    width: 80px; height: 80px;
    opacity: 0.3; filter: grayscale(100%);
    pointer-events: none;
  }

  .target-box.highlight { transform: scale(1.1); background: rgba(255,255,255,0.8); border-color: #333; }
  .target-box.correct { border-style: solid; border-color: #2ecc71; background: #fff; transform: scale(1.1); }
  .target-box.correct img { opacity: 1; filter: none; }

  /* DRAGGABLE ITEMS */
  .draggables-row {
    display: flex;
    justify-content: center;
    gap: 25px;
    width: 100%;
    min-height: 120px; /* Reserve space */
  }

  .drag-item {
    width: 100px; height: 100px;
    background: #fff;
    border-radius: 50%;
    border: 5px solid #fff;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    display: flex; justify-content: center; align-items: center;
    touch-action: none; /* VITAL */
    position: relative; /* Starts relative, becomes fixed on drag */
    z-index: 10;
  }

  .drag-item img {
    width: 70px; height: 70px;
    pointer-events: none; /* Clicks pass through image to the div */
  }

  /* BUTTONS */
  .footer {
    height: 15vh;
    display: flex; justify-content: center; align-items: center;
    gap: 20px;
  }
  .btn {
    width: 60px; height: 60px; border-radius: 50%; border: none;
    color: white; font-size: 1.5rem; box-shadow: 0 5px 0 rgba(0,0,0,0.2);
    cursor: pointer; display: flex; justify-content: center; align-items: center;
  }
  .btn:active { transform: translateY(4px); box-shadow: none; }
  .btn-skip { background: var(--btn-color); }
  .btn-sound { background: #2EC4B6; }

  /* CONFETTI */
  canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 9999; }

  /* WELCOME OVERLAY */
  #welcome {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(255,255,255,0.95);
    z-index: 10000;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .start-btn { padding: 15px 40px; font-size: 1.5rem; background: var(--btn-color); color: white; border: none; border-radius: 50px; }

</style>
</head>
<body>

  <div id="welcome">
    <h1>ü¶Å Match World üçé</h1>
    <p>For Anvita</p>
    <button class="start-btn" onclick="startGame()">Start Playing</button>
  </div>

  <div class="header">
    <h1>Match Game</h1>
    <div class="score">‚≠ê <span id="scoreVal">0</span></div>
  </div>

  <div class="game-board">
    <div class="targets-row" id="targetsContainer"></div>
    
    <div style="opacity:0.5; font-size:2rem;">‚¨á</div>

    <div class="draggables-row" id="draggablesContainer"></div>
  </div>

  <div class="footer">
    <button class="btn btn-sound" onclick="playSound('pop')">üîä</button>
    <button class="btn btn-skip" onclick="nextLevel()">‚ûú</button>
  </div>

  <canvas id="confetti"></canvas>

<script>
// --- ROBUST IMAGE DATABASE (CDN) ---
const ITEMS = [
  { id: 'lion', img: 'https://cdn-icons-png.flaticon.com/512/616/616412.png', name: 'Lion' },
  { id: 'cat', img: 'https://cdn-icons-png.flaticon.com/512/616/616430.png', name: 'Cat' },
  { id: 'dog', img: 'https://cdn-icons-png.flaticon.com/512/616/616408.png', name: 'Dog' },
  { id: 'elephant', img: 'https://cdn-icons-png.flaticon.com/512/616/616434.png', name: 'Elephant' },
  { id: 'apple', img: 'https://cdn-icons-png.flaticon.com/512/415/415733.png', name: 'Apple' },
  { id: 'banana', img: 'https://cdn-icons-png.flaticon.com/512/415/415682.png', name: 'Banana' },
  { id: 'car', img: 'https://cdn-icons-png.flaticon.com/512/2554/2554936.png', name: 'Car' },
  { id: 'bus', img: 'https://cdn-icons-png.flaticon.com/512/2554/2554905.png', name: 'Bus' },
  { id: 'sun', img: 'https://cdn-icons-png.flaticon.com/512/869/869869.png', name: 'Sun' },
  { id: 'moon', img: 'https://cdn-icons-png.flaticon.com/512/1162/1162483.png', name: 'Moon' }
];

// --- STATE ---
let currentItems = [];
let matchesLeft = 0;
let score = 0;

// --- AUDIO ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(type) {
  if (audioCtx.state === 'suspended') audioCtx.resume();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  const now = audioCtx.currentTime;
  
  if (type === 'pop') {
    osc.frequency.setValueAtTime(400, now);
    osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.linearRampToValueAtTime(0, now + 0.1);
    osc.start(now); osc.stop(now + 0.1);
  } else if (type === 'win') {
    osc.frequency.setValueAtTime(500, now);
    osc.frequency.setValueAtTime(1000, now + 0.1);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.linearRampToValueAtTime(0, now + 0.3);
    osc.start(now); osc.stop(now + 0.3);
  }
}

function speak(text) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 0.9;
  window.speechSynthesis.speak(u);
}

// --- GAME LOGIC ---
function startGame() {
  document.getElementById('welcome').style.display = 'none';
  playSound('pop');
  nextLevel();
}

function nextLevel() {
  // Shuffle and pick 2 items
  const shuffled = [...ITEMS].sort(() => 0.5 - Math.random());
  currentItems = shuffled.slice(0, 2);
  matchesLeft = 2;
  renderGame();
  setTimeout(() => speak(`Find the ${currentItems[0].name} and ${currentItems[1].name}`), 500);
}

function renderGame() {
  const tCon = document.getElementById('targetsContainer');
  const dCon = document.getElementById('draggablesContainer');
  tCon.innerHTML = ''; dCon.innerHTML = '';

  // Render Targets
  currentItems.forEach(item => {
    const box = document.createElement('div');
    box.className = 'target-box';
    box.id = `target-${item.id}`;
    // Image placeholder
    box.innerHTML = `<img src="${item.img}" onerror="this.src='https://via.placeholder.com/80?text=?'">`;
    tCon.appendChild(box);
  });

  // Render Draggables (Shuffled)
  const draggables = [...currentItems].sort(() => 0.5 - Math.random());
  draggables.forEach(item => {
    const el = document.createElement('div');
    el.className = 'drag-item';
    el.id = `drag-${item.id}`;
    el.dataset.id = item.id;
    el.dataset.name = item.name;
    el.innerHTML = `<img src="${item.img}">`;
    
    // ATTACH THE MOBILE DRAG LOGIC
    makeDraggable(el);
    dCon.appendChild(el);
  });
}

// --- THE FIX: ROBUST MOBILE DRAG LOGIC ---
function makeDraggable(el) {
  let startX, startY;
  let initialLeft, initialTop;
  let isDragging = false;

  // Touch Start
  el.addEventListener('touchstart', (e) => {
    e.preventDefault(); // Stop scroll immediately
    const touch = e.touches[0];
    const rect = el.getBoundingClientRect();
    
    isDragging = true;
    startX = touch.clientX;
    startY = touch.clientY;
    
    // Switch to fixed to float over everything
    el.style.position = 'fixed';
    el.style.left = rect.left + 'px';
    el.style.top = rect.top + 'px';
    el.style.zIndex = 1000;
    el.style.width = '100px'; 
    el.style.height = '100px';
    
    playSound('pop');
    speak(el.dataset.name);
    
    // Visual pop
    el.style.transform = "scale(1.2)";
  }, { passive: false });

  // Touch Move
  el.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    e.preventDefault(); // CRITICAL: Prevents screen scrolling
    const touch = e.touches[0];
    
    const dx = touch.clientX - startX;
    const dy = touch.clientY - startY;

    // Offset Y by -70px so user can see what they are holding
    el.style.transform = `translate(${dx}px, ${dy - 70}px) scale(1.2)`;
    
    // Highlight Target if close
    checkProximity(el);
  }, { passive: false });

  // Touch End
  el.addEventListener('touchend', (e) => {
    if (!isDragging) return;
    isDragging = false;
    
    // Check match based on Distance, not "dropping on top"
    const target = document.getElementById(`target-${el.dataset.id}`);
    const dist = getDistance(el, target);

    // If closer than 80px (very forgiving)
    if (dist < 80) {
      handleSuccess(el, target);
    } else {
      // Bounce back
      el.style.transition = "all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
      el.style.transform = "translate(0,0) scale(1)";
      
      setTimeout(() => {
        el.style.position = 'relative';
        el.style.left = ''; el.style.top = ''; el.style.zIndex = ''; 
        el.style.transition = '';
      }, 300);
    }
    
    // Clear highlights
    document.querySelectorAll('.target-box').forEach(b => b.classList.remove('highlight'));
  });
}

// --- DISTANCE CALCULATION (The Magic Fix) ---
function getDistance(dragEl, targetEl) {
  if (!targetEl) return Infinity;
  
  // Get center points
  const r1 = dragEl.getBoundingClientRect();
  const r2 = targetEl.getBoundingClientRect();
  const c1 = { x: r1.left + r1.width/2, y: r1.top + r1.height/2 }; // Center of dragged item
  
  // Correction: We moved the visual item up by 70px during drag using translate
  // So the "visual" center is actually higher than the element's box.
  // We compensate for that visual offset here.
  const visualY = c1.y - 70; 

  const c2 = { x: r2.left + r2.width/2, y: r2.top + r2.height/2 }; // Center of target
  
  // Pythagorean theorem
  return Math.hypot(c1.x - c2.x, visualY - c2.y);
}

function checkProximity(dragEl) {
  document.querySelectorAll('.target-box').forEach(box => {
    const dist = getDistance(dragEl, box);
    if (dist < 80) box.classList.add('highlight');
    else box.classList.remove('highlight');
  });
}

function handleSuccess(dragEl, targetEl) {
  dragEl.remove();
  targetEl.classList.add('correct');
  playSound('win');
  spawnConfetti();
  
  score++;
  document.getElementById('scoreVal').innerText = score;
  matchesLeft--;
  
  if (matchesLeft === 0) {
    speak("Yay! Good job.");
    setTimeout(nextLevel, 2000);
  }
}

// --- CONFETTI ---
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
let particles = [];
canvas.width = window.innerWidth; canvas.height = window.innerHeight;

function spawnConfetti() {
  for(let i=0; i<30; i++) {
    particles.push({
      x: window.innerWidth/2, y: window.innerHeight/2,
      vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10 - 5,
      life: 50, color: `hsl(${Math.random()*360}, 100%, 50%)`
    });
  }
}
function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=particles.length-1; i>=0; i--) {
    let p = particles[i];
    p.x += p.vx; p.y += p.vy; p.vy += 0.2; p.life--;
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x, p.y, 8, 8);
    if(p.life<=0) particles.splice(i,1);
  }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
